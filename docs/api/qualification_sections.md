# Контроллер для управление квалификационной секцией

## Управление секцией

### `GET /qualification_sections/{id}`

> Получить секцию. Участник имеет доступ только если это его секция

_Уровень доступа:_ `[admin, user]`\
_Переменные пути:_

- `id` - id секции

_Ответы:_

- **Успешно**\
  `200 Ok`\
  [`section.json`](../models/section.md)
- [**Секция не найдена**](../policies/user_errors.md/#не-найдено)

## Управление раундом в секции

### `GET /qualification_sections/{id}/rounds/{round_number}`

> Получить раунд. Участник имеет доступ только если это его секция

_Уровень доступа:_ `[admin, user]`\
_Переменные пути:_

- `id` - id секции
- `round_number` - номер раунда

_Ответы:_

- **Успешно**\
  `200 Ok`\
  [`qualification_round_full.json`](../models/qualification_round.md#full)
- [**Секция или раунд не найдены**](../policies/user_errors.md/#не-найдено)

## Управление сериями в раунде

### `GET /qualification_sections/{id}/rounds/{round_number}/ranges`

> Получить серии. Участник имеет доступ только если это его секция

_Уровень доступа:_ `[admin, user]`\
_Переменные пути:_

- `id` - id секции
- `round_number` - номер раунда

_Ответы:_

- **Успешно**\
  `200 Ok`\
  [`range_group.json`](../models/range_group.md)
- [**Секция или раунд не найдены**](../policies/user_errors.md/#не-найдено)

### `PUT /qualification_sections/{id}/rounds/{round_number}/ranges`

> Изменить серию. Участник имеет доступ только если это его секция и серия активна. Если номера выстрелов в списке дублируются применяется последний встретившийся по порядку.
> [!IMPORTANT]
> Изменение серии - транзакция, если во время изменения произошла ошибка, частничные изменения недопустимы

_Уровень доступа:_ `[admin, user]`\
_Переменные пути:_

- `id` - id секции
- `round_number` - номер раунда

_Тело запроса:_

```json
{
  "range_number": 1,
  "shots": [
    {
      "shot_number": 1,
      "score": "7"
    },
    {
      "shot_number": 2,
      "score": "M"
    },
    {
      "shot_number": 3,
      "score": "X"
    }
  ]
}
```

_Ответы:_

- **Успешно**\
  `200 Ok`\
  [`range.json`](../models/range.md)
- [**Секция, раунд или серия не найдены**](../policies/user_errors.md/#не-найдено)
- [**Неверные параметры**](../policies/user_errors.md#неверные-параметры)
- **Счет выстрела не соответсвует типу серии**
  `400 Bad request`
  ```json
  {
    "error": "INVALID SCORE",
    "details": {
      "shot_number": 2,
      "type": "6-10"
    }
  }
  ```
- [](../policies/user_errors.md#невозможно-выполнить-действие)

### `POST /qualification_sections/{id}/rounds/{round_number}/ranges/{range_number}/end`

> Подверждение того, что серия закончена.
>
> 1. Если серия не является последней в раунде, необходимо привести в активное состояние следующую.
> 2. Иначе, необходимо завершить раунд.
> 3. Если завершенный раунд не последний, привести в активное состояние следующий раунд и его первую серию.
>
> Участник имеет доступ только если это его секция, и выбранная серия активна.
> Серию можно завершить, если у всех выстрелов в серии выставлен non-null счёт.
> Завершение неактивной серии невозможно

_Уровень доступа:_ `[admin, user]`\
_Переменные пути:_

- `id` - id секции
- `round_number` - номер раунда
- `range_number` - номер серии

_Ответы:_

- **Успешно**\
  `200 Ok`\
  [`range.json`](../models/range.md)
- [**Секция, раунд или серия не найдены**](../policies/user_errors.md/#не-найдено)
- [**Невозможно завершить неполную или неактивную серию**](../policies/user_errors.md#невозможно-выполнить-действие)
