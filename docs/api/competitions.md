# Контроллер для управления соревнованиями

## Управление соревнованием

### `PUT /competitions/{competition_id}`

> Изменить существующее соревнование

_Уровень доступа:_ `[admin]`\
_Переменные пути:_

- `competition_id` - id соревнования

_Тело запроса:_

```json
{
  "start_date": "2025-02-18",
  "end_date": "2025-02-19"
}
```

_Ответы:_

- **Успешно**\
  `200 Ok`\
  [`competition.json`](../models/competition.md)
- [**Неверные параметры соревнования**](../policies/user_errors.md/#неверные-параметры)
- [**Соревнование не найдено**](../policies/user_errors.md/#не-найдено)

### `DELETE /competitions/{competition_id}`

> [!WARNING]
> Безвозвратно удалить соревнование. Является каскадным удалением и должно помимо самого соревнования удалить все сопутсвующие с ним группы и информацию о регистрации участников

_Уровень доступа:_ `[admin]`\
_Переменные пути:_

- `competition_id` - id соревнования

_Ответы:_

- **Успешно**\
  `204 No content`

### `POST /competitions/{competition_id}/end`

> Завершить соревнование (при применении к завершенному - только получает соревнование)

_Уровень доступа:_ `[admin]`\
_Переменные пути:_

- `competition_id` - id соревнования

_Ответы:_

- **Успешно**\
  `200 Ok`\
  [`competition.json`](../models/competition.md)
- [**Невозможно завершить соревнование из-за незавершенных групп**](../policies/user_errors.md/#невозможно-выполнить-действие)
- [**Соревнование не найдено**](../policies/user_errors.md/#не-найдено)

## Управление участниками соревнования

### `POST /competitions/{competition_id}/competitors`

> Добавить участника в соревнование (для добавленных ранее возвращает уже созданную запись)

_Уровень доступа:_ `[admin]`\
_Переменные пути:_

- `competition_id` - id соревнования

_Тело запроса:_

```json
{
  "competitor_id": 6731
}
```

_Ответы:_

- **Успешно**\
  `200 Ok`\
  [`competitor_competition_detail.json`](../models/competitor_competition_detail.md)
- [**Невозможно добавить участников после окончания соревнования**](../policies/user_errors.md/#невозможно-выполнить-действие)
- [**Соревнование или участник не найдены**](../policies/user_errors.md/#не-найдено)

### `GET /competitions/{competition_id}/competitors`

> Получить список зарегистрированных участников. Участник имеет доступ только если сам зарегистрирован

_Уровень доступа:_ `[admin, user]`\
_Переменные пути:_

- `competition_id` - id соревнования

_Ответы:_

- **Успешно**\
  `200 Ok`\
  `[`[`competitor_competition_detail.json`](../models/competitor_competition_detail.md)`]`
- [**Соревнование не найдено**](../policies/user_errors.md/#не-найдено)

### `PUT /competitions/{competition_id}/competitors/{competitor_id}`

> Изменить статус участника в соревновании. Невозможно поменять статус, если участник состоит в активной группе этого соревнования(не на стадии создания). Участник имеет доступ, если меняет свой статус

_Уровень доступа:_ `[admin, user]`\
_Переменные пути:_

- `competition_id` - id соревнования
- `competitor_id` - id участника

_Тело запроса:_

```json
{
  "is_active": false
}
```

_Ответы:_

- **Успешно**\
  `200 Ok`\
  [`competitor_competition_detail.json`](../models/competitor_competition_detail.md)
- [**Невозможно добавить участников после окончания соревнования**](../policies/user_errors.md/#невозможно-выполнить-действие)
- [**Соревнование или участник не найдены**](../policies/user_errors.md/#не-найдено)

### `DELETE /competitions/{competition_id}/competitors/{competitor_id}`

> Удалить зарегистрированного участника. Участник не может быть удалён, если участник состоит в активной группе этого соревнования(не на стадии создания)

_Уровень доступа:_ `[admin]`\
_Переменные пути:_

- `competition_id` - id соревнования
- `competitor_id` - id участника

_Ответы:_

- **Успешно**\
  `204 No content`
- [**Невозможно удалить участника**](../policies/user_errors.md/#невозможно-выполнить-действие)
- [**Соревнование не найдено**](../policies/user_errors.md/#не-найдено)

## Управление индивидуальными группами (на уровне соревнований)

### `POST /competitions/{competition_id}/individual_groups`

> Добавить индивидуальную группу в соревнования. Сразу добавляет в группу подходящих участников из списка зарегистрированных

_Уровень доступа:_ `[admin]`\
_Переменные пути:_

- `competition_id` - id соревнования

_Тело запроса:_

```json
{
  "bow": "classic",
  "identity": "male"
}
```

_Перечисления:_

- `bow`: [bow_class](../enums/bow_class.md)
- `identity`: [gender](../enums/gender.md) | `null`

_Ответы:_

- **Успешно**\
  `201 Created`\
  [`individual_group.json`](../models/individual_group.md)
- [**Группа с такими параметрами уже существует**](../policies/user_errors.md/#ресурс-уже-существует)
- [**Невозможно добавить группу в завершенное соревнование**](../policies/user_errors.md/#невозможно-выполнить-действие)
- [**Соревнование не найдено**](../policies/user_errors.md/#не-найдено)

### `GET /competitions/{competition_id}/individual_groups`

> Получить все группы, доступные пользователю (участник получает только те, в которых принимает участие)

_Уровень доступа:_ `[admin, user]`\
_Переменные пути:_

- `competition_id` - id соревнования

_Ответы:_

- **Успешно**\
  `200 Ok`
  `[`[`individual_group.json`](../models/individual_group.md)`]`
- [**Соревнование не найдено**](../policies/user_errors.md/#не-найдено)
